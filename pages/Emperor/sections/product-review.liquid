<style>
	.product-reviews-title {
		text-align: center;
		margin-top: 56px;
		font-size: 32px;
	}

	.product-reviews--content {
		padding: 30px;
		margin-top: 40px;
		border: 1px solid #eee;
	}

	.product-reviews--header-rating_sum {
		background: #FFC700;
		color: #fff;
		border-radius: 4px;
		font-size: 20px;
		width: 60px;
		height: 60px;
		line-height: 60px;
		text-align: center;
		font-weight: bold;
	}

	.product-reviews--header-commentScore {
		font-size: 16px;
	}

	.product-reviews--header {
		display: flex;
		justify-content: space-between;
	}

	.product-reviews--header-rating {
		margin-right: 30px;
		padding-right: 30px;
		border-right: 1px solid #eee;
		display: flex;
	}

	.star-list {
		color: #999
	}

	.product-reviews--header .star_wrap+div {
		margin-left: 20px;
	}

	.product-reviews--header-rating__progress {
		height: 10px;
		width: 110px;
		background-color: #eee;
		margin-right: 15px;
		margin-left: 10px;
		color: #FFC700
	}

	.star-ul li {
		display: flex;
		align-items: center;
	}

	.product-reviews--header__write-btn-container {
		flex: 1;
		display: flex;
		align-items: flex-start;
		justify-content: flex-end;
	}

	#product-reviews--header__write-btn {
		width: 260px;
		padding-top: 10px;
		padding-bottom: 10px;
		font-size: 14px;
		outline: none;
		border: none;
		background-color: rgb(206 121 92);
		color: #fff;
	}

	.product-reviews--tab {
		border-bottom: 1px solid #eee;
		display: flex;
		align-items: center;
		justify-content: space-between;
		font-size: 14px;
	}

	.product-reviews--tab__item {
		padding-bottom: 7px;
		margin-right: 30px;
		font-size: 16px;
		text-align: center;
		cursor: pointer;
	}

	.product-reviews--tab__item_on {
		color: #FFC700;
		font-weight: bold;
		border-bottom: 3px solid #FFC700;
	}

	.product-reviews--body {
		margin-top: 40px;
	}

	.product-reviews-list__item--header {
		display: flex;
	}

	.product-reviews-list__item_header-img {
		height: 44px;
		width: 44px;
		border-radius: 22px;
		color: #666;
		background-color: #e9e9e9;
		line-height: 44px;
		text-align: center;
		font-size: 22px;
	}

	.product-reviews-list__item_header-rating {
		display: flex;
		flex: 1;
		flex-direction: column;
		justify-content: center;
		margin-left: 14px;
	}

	.product-reviews-list__item_header-rating-name {
		margin-bottom: 6px;
		color: #212121;
		font-weight: bold;
	}

	.product-reviews-list__item--header .star_wrap {
		margin-left: 0;
	}

	.product-reviews-list__item--header .star_wrap .star {
		width: 14px;
		height: 14px;
	}

	.product-reviews-list__item {
		margin-top: 30px;
		border-bottom: 1px solid #eee;
		padding-bottom: 30px;
	}

	.product-reviews-list__item--reply {
		padding: 15px 12px;
		background: #F6F6F6;
		margin-top: 6px;
		border-radius: 2px;
		margin-top: 10px;
	}

	.product-reviews-list__item--reply .reply-title {
		margin-bottom: 6px;
		color: #000;
		font-size: 14px;
		font-weight: bold;
	}

	.product-reviews-list__item--reply p {
		font-size: 14px;
		color: #999;
		line-height: 14px;
	}

	.get_more_wrap {
		margin-top: 20px;
		text-align: center;
	}

	.get_more_btn {
		margin-top: 20px;
		text-align: center;
		font-size: 16px;
		font-weight: bold;
		color: var(--vshop-primary-color);
		line-height: 1;
		text-align: center;
		border-bottom: 1px solid var(--vshop-primary-color);
		cursor: pointer;
		display: inline-block;
	}

	.product-reviews-list__item--time {
		color: #9f9f9f;
		margin-top: 15px;
	}

	.product-reviews-blank {
		text-align: center;
	}

	.product-reviews-blank .product-reviews-header__write-btn {
		font-size: var(--button-font-size);
		outline: none;
		border: var(--button-style);
		cursor: pointer;
		background-color: var(--button-bg);
		color: var(--button-text-color);
		margin-top: 20px;
		padding:10px 25px;
	}

	@media (max-width:768px){
	  .product-reviews-blank .product-reviews-header__write-btn {
		font-size: var(--button-wap-font-size);
	  }
	}

	.product-reviews-list .z_img_inner {
		padding: 10px 20px 0 0;
	}

	.product-reviews-list .z_img_inner dd {
		width: 120px;
		height: 120px;
		background: #D8D8D8;
		float: left;
		margin: 0 10px 10px 0;
	}

	.product-reviews-list .z_img_inner .z_img {
		padding-bottom: 100% !important;
		position: relative;
		margin: 0 auto;
		overflow: hidden;
		cursor: pointer;
	}

	.product-reviews-list .z_img_inner img {
		display: block;
		-o-object-fit: contain;
		object-fit: contain;
		position: absolute;
		max-height: 100%;
		max-width: 100%;
		left: 50%;
		top: 50%;
		transform: translate(-50%, -50%);
	}

	.swiper-bg {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background-color: rgba(0, 0, 0, 0.7);
		z-index: 9999;
	}

	.swiper-bg>i {
		position: absolute;
		right: 20px;
		top: 20px;
		font-size: 24px;
		text-shadow: 1px 1px 2px black, 0 0 1em black;
		color: #fff;
		display: block;
		cursor: pointer;
		z-index: 10000;
	}

	#setmeal-dialog-tpl-swiper .swiper-slide {
		display: flex;
		justify-content: center;
		align-items: center;
		margin-right: 0;
	}

	#setmeal-dialog-tpl-swiper .swiper-slide img {
		max-width: 80%;
		max-height: 80%;
	}

	#setmeal-dialog-tpl-swiper .swiper-button-prev {
		left: 30px;
		font-size: 22px !important;
	}

	#setmeal-dialog-tpl-swiper .swiper-button-next {
		right: 30px;
		font-size: 22px !important;
	}

	@media (max-width:768px) {
		.product-reviews-title {
			font-size: 20px;
		}

		.product-reviews--header {
			display: block;
		}

		.product-reviews--header>div {
			margin-bottom: 10px;
		}

		.product-reviews--header-rating {
			border: none
		}

		.product-reviews--header__write-btn-container {
			justify-content: center;
		}

		#product-reviews--header__write-btn {
			width: 100%;
		}

		.star-list .iconfont {
			font-size: 14px;
		}

		.product-reviews--header-rating>div:last-child {
			display: flex;
			align-items: center;
			flex-wrap: wrap;
		}

		.product-reviews--content {
			margin-top: 20px;
		}

		.product-info__views .star_wrap {
			margin-left: 0;
		}

		.product-info__views>div {
			margin-top: 10px;
			flex-basis: 100%;
		}

		.product-reviews-list .z_img_inner {
			display: flex;
			flex-wrap: wrap;
		}

		.product-reviews-list .z_img_inner dd {
			width: calc(33.3% - 10px);
			flex-basis: calc(33.3% - 10px);
			height: auto;
		}


		.product-reviews-list .z_img_inner {
			padding: 0;
		}
	}
</style>
{% assign commentList = data.commentList %}
{% assign commentListSize = data.commentList | size %}
{% assign review_data = commentList | reviewData %}
<div class="col-12">
	<h4 class="product-reviews-title"> {{'i18n.product_detail.review' | t: lang}}</h4>
	<div class="product-reviews--content">
		{%if commentListSize > 0 %}
		<div class="product-reviews--header">
			<div class="product-reviews--header-rating">
				<div class="product-reviews--header-rating_sum">
					<span>{{data.commentScore}}</span>/<span class="product-reviews--header-commentScore">5</span>
				</div>
				<div>
					{% render 'product-star',data: data.commentScore | at_least: 1 | at_most: 5 ,lang:lang%}
					<div>
						{{'i18n.product_detail.based-on-reviews' | t: lang ,commentListLen:commentList.size}}
					</div>
				</div>
			</div>
			<div>
				<ul class="star-ul">
					<li>
						<div class="star-list">
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star-fill iconfont"></i>
						</div>
						<progress class="product-reviews--header-rating__progress" value="{{review_data[4]}}"
							max="{{commentList.size}}"></progress>
						({{review_data[4]}})
					</li>
					<li>
						<div class="star-list">
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star iconfont"></i>
						</div>
						<progress class="product-reviews--header-rating__progress" value="{{review_data[3]}}"
							max="{{commentList.size}}"></progress>
						({{review_data[3]}})
					</li>
					<li>
						<div class="star-list">
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star iconfont"></i>
							<i class="icon-star iconfont"></i>
						</div>
						<progress class="product-reviews--header-rating__progress" value="{{review_data[2]}}"
							max="{{commentList.size}}"></progress>
						({{review_data[2]}})
					</li>
					<li>
						<div class="star-list">
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star iconfont"></i>
							<i class="icon-star iconfont"></i>
							<i class="icon-star iconfont"></i>
						</div>
						<progress class="product-reviews--header-rating__progress" value="{{review_data[1]}}"
							max="{{commentList.size}}"></progress>
						({{review_data[1]}})
					</li>
					<li>
						<div class="star-list">
							<i class="icon-star-fill iconfont"></i>
							<i class="icon-star iconfont"></i>
							<i class="icon-star iconfont"></i>
							<i class="icon-star iconfont"></i>
							<i class="icon-star iconfont"></i>
						</div>
						<progress class="product-reviews--header-rating__progress" value="{{review_data[0]}}"
							max="{{commentList.size}}"></progress>
						({{review_data[0]}})
					</li>
				</ul>
			</div>
			<div class="product-reviews--header__write-btn-container">
				<button type="button" id="product-reviews--header__write-btn">{{'i18n.product_detail.write-a-review' |
					t: lang}}</button>
			</div>
		</div>
		<div class="product-reviews--body">
			<div class="product-reviews--tab">
				<span class="product-reviews--tab__item product-reviews--tab__item_on">
					{{'i18n.product_detail.reviews' | t: lang }}
				</span>
			</div>
			{% if commentList.size > 5 %}
			{%- comment -%} 获取前五条数据 {%- endcomment -%}
			{% assign commentList_data = commentList | slice: 0, 5%}
			{% else%}
			{% assign commentList_data = commentList %}
			{% endif%}
			<ul class="product-reviews-list">
				{% for item in commentList_data %}
				<li class="product-reviews-list__item">
					<div class="product-reviews-list__item--header">
						<div class="product-reviews-list__item_header-img notranslate iconfont icon-personal">
						</div>
						<div class="product-reviews-list__item_header-rating">
							<div class="product-reviews-list__item_header-rating-name">
								{{item.name}}
							</div>
							{% render 'product-star',data: item.star | at_least: 1 | at_most: 5,lang:lang %}
						</div>
						<div class="product-reviews-list__item_header-country_code">
							{{item.country}}
						</div>
					</div>
					<p class="product-reviews-list__item_content">
						{{item.comment}}
					</p>
					{% if item.commentResourceList.size > 0%}
					<dl class="clearfix z_img_inner">
						{% for citem in item.commentResourceList %}
						<dd>
							<div class="z_img" data-src="{{citem.url}}" data-index="{{forloop.index0}}">
								<img src="{{citem.url}}">
							</div>
						</dd>
						{% endfor %}
					</dl>
					{% endif %}
					{% if item.reply and item.reply != '' %}
					<div class="product-reviews-list__item--reply">
						<div class="reply-title"> {{'i18n.product_detail.merchant-reply' | t: lang }}</div>
						<p>{{item.reply}}</p>
					</div>
					{% endif%}
					<div class="product-reviews-list__item--time">
						{{item.createTime}}
					</div>
				</li>
				{% endfor %}
				{% if commentList.size > 5 %}
				<div class="get_more_wrap">
					<p class="get_more_btn product-reviews-header__write-btn button-font">{{'i18n.product_detail.view-more-comment'
						| t: lang }}</p>
				</div>
				{% endif %}
			</ul>
		</div>
		{%else%}
		<div class="product-reviews-blank">
			<div class="product-reviews-blank__desc">{{'i18n.product_detail.no_reviews_tip' | t: lang }}</div>
			<button type="button" class="product-reviews-header__write-btn button-font"
				id="product-reviews-write-btn">{{'i18n.product_detail.write_a_review' | t: lang }}</button>
		</div>
		{%endif%}
	</div>
	{% render 'product-comment-form',lang:lang %}
</div>
<script>
	const commentList = {{ commentList | json}}
	$('.get_more_btn').on('click', function (event) {
		event.stopPropagation();
		let space = $('.product-reviews-list li').length,
			newCommentList = [];
		if (space > 0) {
			newCommentList = commentList.slice(space, space + 5);
		}
		let html = ''
		newCommentList.forEach(item => {
			let commentImgList = '<dl class="clearfix z_img_inner">'
			if (!!item.commentResourceList) {
				item.commentResourceList.forEach((val, index) => {
					if (!!val.url) {
						commentImgList += `<div class="z_img" data-src="${val.url}" data-index="${index}"> <img src="${val.url}"> </div>`
					}
				})
			}
			commentImgList += `</dl>`
			const reviews_list = `<li class="product-reviews-list__item">
					<div class="product-reviews-list__item--header">
						<div class="product-reviews-list__item_header-img notranslate iconfont icon-personal">
						</div>
						<div class="product-reviews-list__item_header-rating">
							<div class="product-reviews-list__item_header-rating-name">
								${item.name}
							</div>
							${starHtml(item.star)}
						</div>
						<div class="product-reviews-list__item_header-country_code">
							${item.country || ''}
						</div>
					</div>
					<p class="product-reviews-list__item_content">
						${item.comment}
					</p>

					<div class="product-reviews-list__item--reply ${!!item.reply ? '' : 'hide'}">
						<div class="reply-title"> {{'i18n.product_detail.merchant-reply' | t: lang }}</div>
						<p>${item.reply}</p>
					</div>
					<div class="product-reviews-list__item--time">
						${item.createTime}
					</div>
				</li>`
			html += reviews_list
		});

		$('.get_more_wrap').before(html)

		if (commentList.length == $('.product-reviews-list li').length) {
			$(this).addClass('hide')
		}
		function starHtml(num) {
			let starStr = ''
			for (let i = 0; i < num; i++) {
				starStr += `<i class="star"></i>`
			}
			for (let i = 0; i < (5 - num); i++) {
				starStr += `<i class="star empty"></i>`
			}
			return `<span class="star_wrap"> <span class="star_inner"> ${starStr} </span> </span>`
		}
	});
	$('.product-reviews-list').on('click', '.z_img', function (event) {
		event.stopPropagation();
		let $cIndex = $(this).attr('data-index'),
			$dialogSwiper = null,
			allImg = [];

		$(this).parents('.z_img_inner').find('.z_img').each(function (index, item) {
			allImg.push({ 'mainImg': $(item).attr('data-src') });
		});
		if (allImg.length) {

			let swiperWrapper = ''
			allImg.forEach(item => {
				swiperWrapper += `<div class="swiper-slide">  <img src="${item.mainImg}" class="box-img"/> </div>`
			})
			const swiperHtml = `
			<div class='swiper-bg'>
				<i class='iconfont icon-fine-cross'></i>
			<div class="swiper-container" id="setmeal-dialog-tpl-swiper">
        <div class="swiper-wrapper"> ${swiperWrapper} </div>
        <div class="swiper-button-prev dialogPrevBtn iconfont icon-arrow-left"></div>
        <div class="swiper-button-next dialogNextBtn iconfont icon-arrow-right"></div>
    </div></div>`
			$('body').append(swiperHtml)
			let $dialogSwiper = new Swiper(
				'#setmeal-dialog-tpl-swiper', {
				navigation: {
					prevEl: '.swiper-button-prev',
					nextEl: '.swiper-button-next'
				}
			});
			$dialogSwiper.slideTo($cIndex);
		}
	});
	$(document).on('click', '.swiper-bg>i', function () {
		$(this).closest('.swiper-bg').remove()
	})
</script>
